import{r as v,Q as x,y as P,R as F,d as O,o as W,h as G,g as h,l as E,A as U,B as q}from"./index-akmvSqau.js";import{a as V}from"./marker.service-CA0cae7z.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const C=v(""),$=v(""),A=v(null),B=v(null);function ne(){function p(c,s){const n={key:s,latlng:c};return fetch("https://api.woosmap.com/localities/geocode/?".concat(r(n))).then(e=>e.json())}function r(c){const s=[];for(let n in c)if(c.hasOwnProperty(n)){let e=c[n];s.push("".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(e)))}return s.join("&")}function d(c,s){let n=c+","+s;p(n,x).then(e=>{let o=e.results[0];$.value=o.formatted_address,e.results==null||e.results.length})}function w(c,s){A.value=c,B.value=s}function m(){A.value=null,B.value=null,$.value="",C.value=""}return{spotName:C,address:$,latitude:A,longitude:B,setCoordonates:w,resetCoordonates:m,reverseGeocodeMarker:d}}function le(p){let r;P(()=>{d()});function d(){r=new woosmap.map.Map(document.getElementById(p),{zoom:4,disableDefaultUI:!0,styles:F})}function w(n,e){new woosmap.map.Marker({position:{lat:n,lng:e},icon:{url:"https://images.woosmap.com/marker.png",scaledSize:{height:50,width:32}}}).setMap(r),r.flyTo({center:{lat:n,lng:e},zoom:14})}function m(n,e){new woosmap.map.Marker({position:{lat:n,lng:e}}).setMap(null)}function c(){const n=V();n.value&&n.value.forEach((e,o)=>{const t={lat:e.location.latitude,lng:e.location.longitude},u=new woosmap.map.Marker({position:t,icon:{url:"https://images.woosmap.com/marker.png",scaledSize:{height:50,width:32}}}),k=new woosmap.map.InfoWindow({}),_="".concat(o,"-").concat(e.createdAt),I=e.photos?e.photos.length:0,L='<div id="'.concat(_,'" class="info-content"><ion-thumbnail slot="start"><img src="').concat(e.thumbnail,'" /></ion-thumbnail><ion-label><h4>').concat(e.address,"</h4><p>").concat(I," photos. <a href='/spot-detail/").concat(e.id,"'>Voir les d√©tails</a></ion-label></div>");k.setOffset(new woosmap.map.Point(50,-500)),k.setContent(L),u.addListener("click",function(){k.open(r,u),r.flyTo({center:u.getPosition(),zoom:14});const f=document.getElementById(_);f&&(f.style.color="blue",f.style.background="white",f.style.display="flex",f.style.gap="8px")}),u.setMap(r)})}function s(){r={}}return{initMap:d,resetMap:s,setMarker:w,setMarkersOnMap:c,removeMarker:m}}function N(p=4){const r=crypto.getRandomValues(new Uint8Array(p));return btoa(String.fromCharCode(...r)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const z=p=>(U("data-v-b595dffc"),p=p(),q(),p),Q=["id"],Y=z(()=>h("svg",{class:"search-icon",viewBox:"0 0 16 16"},[h("path",{d:"M3.617 7.083a4.338 4.338 0 1 1 8.676 0 4.338 4.338 0 0 1-8.676 0m4.338-5.838a5.838 5.838 0 1 0 2.162 11.262l2.278 2.279a1 1 0 0 0 1.415-1.414l-1.95-1.95A5.838 5.838 0 0 0 7.955 1.245","fill-rule":"evenodd","clip-rule":"evenodd"})],-1)),D=["id"],K=["id"],j=z(()=>h("svg",{class:"clear-icon",viewBox:"0 0 24 24"},[h("path",{d:"M7.074 5.754a.933.933 0 1 0-1.32 1.317L10.693 12l-4.937 4.929a.931.931 0 1 0 1.319 1.317l4.938-4.93 4.937 4.93a.933.933 0 0 0 1.581-.662.93.93 0 0 0-.262-.655L13.331 12l4.937-4.929a.93.93 0 0 0-.663-1.578.93.93 0 0 0-.656.261l-4.938 4.93z"})],-1)),J=[j],X=["id"],Z=O({__name:"AutocompleteSearch",emits:["select-city"],setup(p,{emit:r}){const d=N(),w=r;let m,c,s,n,e;const o=v(null),t=v(null),u=v(null);document.addEventListener("click",l=>{!l.target.closest("#autocomplete-container-".concat(d))&&t.value&&(t.value.style.display="none")}),P(()=>{o.value=document.getElementById("autocomplete-input-".concat(d)),t.value=document.getElementById("suggestions-list-".concat(d)),u.value=document.getElementById("clear-searchButton-".concat(d)),n=new woosmap.map.InfoWindow({}),e=new window.woosmap.map.LocalitiesService,m={input:"",types:["locality","address","postal_code"]},c=R(e.autocomplete,0),k()});function k(){o.value&&t.value&&(o.value.addEventListener("input",_),o.value.addEventListener("keydown",l=>{if(l.key==="Enter"&&t.value){const a=t.value.querySelector("li");a&&a.click()}}),u.value&&o.value&&t.value&&u.value.addEventListener("click",()=>{o.value&&t.value&&u.value&&(o.value.value="",t.value.style.display="none",u.value.style.display="none",s&&(s.setMap(null),n.close()),o.value.focus())}))}function _(){if(o.value&&t.value&&o.value){m.input=o.value.value;const l={key:x,input:m.input,types:"locality|postal_code|address",components:"country:fr|country:es"};m.input?c(l).then(a=>f(a)).catch(a=>console.error("Error autocomplete localities:",a)):t.value&&u.value&&(t.value.style.display="none",u.value.style.display="none")}}function I(l){e.getDetails({publicId:l}).then(a=>L(a.result)).catch(a=>console.error("Error getting locality details:",a))}function L(l){s&&(s.setMap(null),n.close()),l!=null&&l.geometry&&(s=new woosmap.map.Marker({position:l.geometry.location,icon:{url:"https://images.woosmap.com/marker.png",scaledSize:{height:50,width:32}}}),w("select-city",l))}function f(l){o.value&&t.value&&u.value&&(t.value.innerHTML="",l.localities.length>0&&m.input?(l.localities.forEach(a=>{var g;const i=document.createElement("li");i.onmouseover=()=>{i.style.backgroundColor="#f2f2f2"},i.onmouseout=()=>{i.style.backgroundColor="#FFFFFF"},i.style.padding="12px",i.style.transition="background-color 0.3s ease",i.style.cursor="pointer",i.style.textAlign="left",i.textContent=(g=a.description)!=null?g:"",i.addEventListener("click",()=>{var y;o.value&&t.value&&(o.value.value=(y=a.description)!=null?y:"",t.value.style.display="none",I(a.public_id))}),t.value&&t.value.appendChild(i)}),t.value.style.display="block",u.value.style.display="block"):t.value.style.display="none")}function R(l,a){let i=null,g=null,y=null;return function(...T){return new Promise((M,b)=>{i!==null&&clearTimeout(i),g=M,y=b,i=setTimeout(()=>{l(...T).then(S=>{g===M&&y===b&&M(S)}).catch(S=>{g===M&&y===b&&b(S)})},a)})}}return(l,a)=>(W(),G("div",{id:"#autocomplete-container-".concat(E(d)),class:"autocomplete-container"},[Y,h("input",{type:"text",id:"autocomplete-input-".concat(E(d)),class:"autocomplete-input",placeholder:"Search Localities...",autocomplete:"off"},null,8,D),h("button",{"aria-label":"Clear",id:"clear-searchButton-".concat(E(d)),class:"clear-searchButton",type:"button"},J,8,K),h("ul",{id:"suggestions-list-".concat(E(d)),class:"suggestions-list"},null,8,X)],8,Q))}}),ae=H(Z,[["__scopeId","data-v-b595dffc"]]);export{ae as A,ne as a,le as u};
